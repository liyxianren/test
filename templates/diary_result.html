<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è®°åˆ†æç»“æœ - CBTæƒ…ç»ªæ—¥è®°æ¸¸æˆ</title>
    <meta name="description" content="æŸ¥çœ‹æ‚¨çš„æƒ…ç»ªæ—¥è®°AIåˆ†æç»“æœå’Œæ¸¸æˆæ•°å€¼å˜åŒ–">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="alternate icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        .result-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .result-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-purple);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-analysis-content {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            min-height: 100px;
        }

        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1em;
            background: var(--primary-purple);
            margin-left: 2px;
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .score-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .score-value-container {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .score-value {
            font-size: 42px;
            font-weight: 700;
            line-height: 1;
        }

        .score-change {
            font-size: 20px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
        }

        .score-change.positive {
            color: #4ade80;
        }

        .score-change.negative {
            color: #f87171;
        }

        .score-reason {
            font-size: 13px;
            margin-top: 10px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .progress-bar-custom {
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .highlights-list {
            list-style: none;
            padding: 0;
        }

        .highlights-list li {
            padding: 12px 16px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
            line-height: 1.6;
        }

        .highlights-list li::before {
            content: 'â­';
            font-size: 20px;
            flex-shrink: 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn-action {
            flex: 1;
            min-width: 180px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-top-color: var(--primary-purple);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            padding: 20px;
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 12px;
            color: #c33;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <span class="navbar-logo-emoji">ğŸ’–</span>
                CBTæƒ…ç»ªæ—¥è®°æ¸¸æˆ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">é¦–é¡µ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/diary">æƒ…ç»ªæ—¥è®°</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/game/home">ğŸ¦Š å°æ©˜çš„å®¶</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/postcards">ğŸ¦Š æ˜ä¿¡ç‰‡</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/stats">æ•°æ®ç»Ÿè®¡</a>
                    </li>
                </ul>
                <div class="d-flex gap-2 align-items-center">
                    <!-- å·²ç™»å½•çŠ¶æ€ -->
                    <div id="authUser" class="d-flex gap-2 align-items-center">
                        <div class="dropdown">
                            <button class="btn btn-outline dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i>
                                <span id="username">ç”¨æˆ·</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/profile"><i class="fas fa-user me-2"></i>ä¸ªäººèµ„æ–™</a></li>
                                <li><a class="dropdown-item" href="/settings"><i class="fas fa-cog me-2"></i>è®¾ç½®</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="javascript:void(0);" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>é€€å‡ºç™»å½•</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="result-container">
        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šAIæƒ…ç»ªåˆ†æ -->
        <div class="result-section">
            <div class="section-title">
                <i class="fas fa-brain"></i>
                AIæƒ…ç»ªåˆ†æ
            </div>
            <div id="aiAnalysisContent" class="ai-analysis-content">
                <div class="text-center py-5">
                    <div class="loading-spinner"></div>
                    <p class="mt-3 text-muted">æ­£åœ¨åˆ†ææ‚¨çš„æƒ…ç»ªæ—¥è®°...</p>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ¸¸æˆæ•°å€¼å˜åŒ– -->
        <div class="result-section">
            <div class="section-title">
                <i class="fas fa-chart-line"></i>
                æ¸¸æˆæ•°å€¼å˜åŒ–
            </div>

            <div id="scoresLoading" class="text-center py-5">
                <div class="loading-spinner"></div>
                <p class="mt-3 text-muted">æ­£åœ¨è®¡ç®—æ•°å€¼å˜åŒ–...</p>
            </div>

            <div id="scoresContent" class="d-none">
                <!-- å¿ƒç†å¥åº·å€¼ -->
                <div class="score-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="score-label">å¿ƒç†å¥åº·å€¼</div>
                    <div class="score-value-container">
                        <div class="score-value" id="mentalHealthValue">50</div>
                        <div class="score-change" id="mentalHealthChange">+0</div>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" id="mentalHealthProgress" style="width: 50%"></div>
                    </div>
                    <div class="score-reason" id="mentalHealthReason"></div>
                </div>

                <!-- å‹åŠ›æ°´å¹³ -->
                <div class="score-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="score-label">å‹åŠ›æ°´å¹³</div>
                    <div class="score-value-container">
                        <div class="score-value" id="stressLevelValue">50</div>
                        <div class="score-change" id="stressLevelChange">+0</div>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" id="stressLevelProgress" style="width: 50%"></div>
                    </div>
                    <div class="score-reason" id="stressLevelReason"></div>
                </div>

                <!-- æˆé•¿æ½œåŠ› -->
                <div class="score-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="score-label">æˆé•¿æ½œåŠ›</div>
                    <div class="score-value-container">
                        <div class="score-value" id="growthPotentialValue">50</div>
                        <div class="score-change" id="growthPotentialChange">+0</div>
                    </div>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" id="growthPotentialProgress" style="width: 50%"></div>
                    </div>
                    <div class="score-reason" id="growthPotentialReason"></div>
                </div>

                <!-- ç§¯æäº®ç‚¹ -->
                <div id="highlightsSection" class="mt-4 d-none">
                    <h5 style="color: var(--primary-purple); margin-bottom: 15px;">
                        <i class="fas fa-star me-2"></i>å‘ç°çš„äº®ç‚¹
                    </h5>
                    <ul class="highlights-list" id="highlightsList"></ul>
                </div>
            </div>

            <div id="scoresError" class="error-message d-none">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span id="errorText">åŠ è½½æ•°å€¼å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</span>
            </div>
        </div>

        <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šè·å¾—å¥–åŠ± -->
        <div id="rewardsSection" class="result-section d-none">
            <div class="section-title">
                <i class="fas fa-gift"></i>
                è·å¾—å¥–åŠ±
            </div>
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <div class="text-center p-3" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-radius: 12px;">
                        <div style="font-size: 32px;">ğŸ’°</div>
                        <div class="fw-bold fs-4 text-warning" id="coinsEarned">+0</div>
                        <div class="small text-muted">è·å¾—é‡‘å¸</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center p-3" style="background: #f0f0f0; border-radius: 12px;">
                        <div style="font-size: 32px;">ğŸ¦</div>
                        <div class="fw-bold fs-4" id="totalCoins">0</div>
                        <div class="small text-muted">æ€»é‡‘å¸</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center p-3" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 12px;">
                        <div style="font-size: 32px;">â­</div>
                        <div class="fw-bold fs-4" id="currentLevel">Lv.1</div>
                        <div class="small text-muted">å½“å‰ç­‰çº§</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center p-3" style="background: #e8f4f8; border-radius: 12px;">
                        <div style="font-size: 32px;">ğŸ“–</div>
                        <div class="fw-bold fs-4" id="diaryCount">0</div>
                        <div class="small text-muted">æ—¥è®°æ•°é‡</div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <small class="text-muted" id="nextLevelProgress">è·ç¦»ä¸‹ä¸€çº§è¿˜éœ€ 10 ç¯‡æ—¥è®°</small>
            </div>
            <div class="text-center mt-2">
                <small class="text-success" id="bonusReason"></small>
            </div>
        </div>

        <!-- ç¬¬å››éƒ¨åˆ†ï¼šCBTæ´å¯Ÿ -->
        <div id="cbtInsightsSection" class="result-section d-none">
            <div class="section-title">
                <i class="fas fa-lightbulb"></i>
                CBTæ´å¯Ÿ
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-muted mb-3"><i class="fas fa-exclamation-triangle me-2 text-warning"></i>è¯†åˆ«åˆ°çš„è®¤çŸ¥æ¨¡å¼</h6>
                    <div id="distortionsList"></div>
                </div>
                <div class="col-md-6">
                    <h6 class="text-muted mb-3"><i class="fas fa-hand-holding-heart me-2 text-info"></i>å»ºè®®</h6>
                    <ul id="recommendationsList" class="list-unstyled"></ul>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
            <a href="/diary" class="btn btn-outline btn-action">
                <i class="fas fa-arrow-left me-2"></i>è¿”å›æƒ…ç»ªæ—¥è®°
            </a>
            <a href="/game/home" class="btn btn-primary btn-action">
                <i class="fas fa-home me-2"></i>å°æ©˜çš„å®¶
            </a>
            <a href="/stats" class="btn btn-success btn-action">
                <i class="fas fa-chart-bar me-2"></i>æŸ¥çœ‹æˆ‘çš„æ•°å€¼
            </a>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <!-- Result Page JS -->
    <script src="{{ url_for('static', filename='js/diary_result.js') }}"></script>
</body>
</html>
